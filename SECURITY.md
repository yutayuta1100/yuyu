# セキュリティ設定ガイド

## 重要：本番環境での設定

### 1. 環境変数の設定（Vercel）

Vercelダッシュボードで以下の環境変数を設定してください：

```
OPENAI_API_KEY=your_actual_api_key_here
NODE_ENV=production
ALLOWED_ORIGIN=https://icfidentifier.com
```

**注意**: APIキーは絶対にクライアントサイドのコードに含めないでください。

### 2. セキュリティ機能

#### APIキーの保護
- OpenAI APIキーはサーバーサイドでのみ使用
- クライアントサイドには一切露出しない

#### レート制限
- 1時間あたり100リクエストまでに制限
- DDoS攻撃からの保護

#### CORS設定
- 本番環境では指定されたドメインからのみアクセス可能
- 開発環境ではlocalhostのみ許可

#### 入力検証とサニタイジング
- HTMLタグと特殊文字の除去
- 文字数制限（5000文字）
- 年齢、性別などのフィールド検証
- 画像サイズとフォーマットの検証

#### Content Security Policy (CSP)
- XSS攻撃からの保護
- 信頼できるソースからのみスクリプトを実行

### 3. 画像アップロードの制限
- 最大5枚まで
- 各画像最大10MB
- 許可された形式のみ（PNG, JPEG, GIF, WebP）

### 4. HTTPSの強制
- すべての通信をHTTPSに自動的にアップグレード

### 5. セキュリティヘッダー
- Helmetを使用して各種セキュリティヘッダーを自動設定

## 定期的な確認事項

1. 依存関係の更新
   ```bash
   npm audit
   npm update
   ```

2. APIキーのローテーション
   - 定期的にAPIキーを更新することを推奨

3. アクセスログの監視
   - 異常なアクセスパターンがないか確認

## 問題が発生した場合

セキュリティ上の問題を発見した場合は、公開のIssueではなく、直接連絡してください。